<!-- <!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Skin Lesion Classifier</title>
  <style>
    body { font-family: Arial; text-align: center; margin-top: 50px; }
    .preview { margin-top: 20px; }
  </style>
</head>
<body>
  <h1>Ph√¢n lo·∫°i t·ªïn th∆∞∆°ng da</h1>
  <form method="POST" enctype="multipart/form-data">
    <input type="file" name="image" accept="image/*" required>
    <button type="submit">D·ª± ƒëo√°n</button>
  </form>

  {% if image %}
    <div class="preview">
      <h3>·∫¢nh b·∫°n ƒë√£ t·∫£i l√™n:</h3>
      <img src="{{ url_for('static', filename='uploads/' ~ image) }}" width="300"><br>
      <h3>K·∫øt qu·∫£ d·ª± ƒëo√°n:</h3>
      <p><strong>{{ prediction }}</strong> (ƒë·ªô tin c·∫≠y: {{ '%.2f'|format(confidence * 100) }}%)</p>
    </div>
  {% endif %}
</body>
</html> -->


<!-- <!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Ph√¢n lo·∫°i b·ªánh da li·ªÖu</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 40px;
            background: #f4f4f4;
            color: #333;
        }
        h1, h2, h3 {
            color: #006699;
        }
        .upload-form {
            margin-bottom: 30px;
        }
        .upload-form input[type="file"] {
            padding: 8px;
        }
        .upload-form input[type="submit"] {
            padding: 10px 20px;
            background-color: #006699;
            color: white;
            border: none;
            cursor: pointer;
        }
        .result, .suggestion, .history {
            background: white;
            padding: 20px;
            margin-bottom: 30px;
            border-radius: 10px;
            box-shadow: 0 0 10px #ccc;
        }
        .result img {
            max-width: 300px;
            display: block;
            margin-top: 10px;
        }
        .history img {
            max-width: 100px;
            margin-right: 10px;
            border: 1px solid #ccc;
        }
        .history-item {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }
        a {
            color: #006699;
            text-decoration: none;
        }
    </style>
</head>
<body>
    <h1>Ph√¢n lo·∫°i b·ªánh da li·ªÖu b·∫±ng h√¨nh ·∫£nh</h1>

    <div class="upload-form">
        <form method="POST" enctype="multipart/form-data">
            <input type="file" name="image" required>
            <input type="submit" value="T·∫£i ·∫£nh v√† d·ª± ƒëo√°n">
        </form>
    </div>

    {% if image %}
    <div class="result">
        <h2>K·∫øt qu·∫£ d·ª± ƒëo√°n</h2>
        <p><strong>B·ªánh:</strong> {{ prediction }}</p>
        <p><strong>ƒê·ªô tin c·∫≠y:</strong> {{ '%.2f'|format(confidence * 100) }}%</p>
        <img src="{{ url_for('static', filename='uploads/' + image) }}" alt="·∫¢nh ƒë√£ t·∫£i l√™n">
    </div>
    {% endif %}

    {% if suggestion %}
    <div class="suggestion">
        <h2>{{suggestion.name}}</h2>
        <p><strong>M√¥ t·∫£:</strong> {{ suggestion.description }}</p>
        <p><a href="{{ suggestion.article }}" target="_blank">üîó B√†i vi·∫øt li√™n quan</a></p>
        <p><a href="{{ suggestion.advice }}" target="_blank">üí° T∆∞ v·∫•n ƒëi·ªÅu tr·ªã</a></p>
        <img src="{{ url_for('static', filename='suggestions/' + suggestion.image) }}" alt="·∫¢nh b·ªánh" width="300">
    </div>
    {% endif %}

    {% if history %}
    <div class="history">
        <h2>L·ªãch s·ª≠ d·ª± ƒëo√°n g·∫ßn ƒë√¢y</h2>
        {% for item in history %}
        <div class="history-item">
            <img src="{{ url_for('static', filename='uploads/' + item.image) }}" alt="L·ªãch s·ª≠">
            <div>
                <p><strong>{{ item.prediction }}</strong> ({{ '%.2f'|format(item.confidence * 100) }}%)</p>
            </div>
        </div>
        {% endfor %}
        <p><a href="{{ url_for('clear_history') }}">üóëÔ∏è Xo√° l·ªãch s·ª≠</a></p>
    </div>
    {% endif %}
</body>
</html> -->
<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8" />
    <title>Ph√¢n lo·∫°i b·ªánh da li·ªÖu</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>

<body>

    <h1>Ph√¢n lo·∫°i t·ªïn th∆∞∆°ng da th√¥ng qua h√¨nh ·∫£nh</h1>

    <div class="horizontal-row">
        <!-- Form Upload v√† n√∫t l·ªãch s·ª≠ -->
        <div class="container upload-form">
            <form method="POST" enctype="multipart/form-data">
                <input type="file" name="image" required><br>
                <input type="submit" value="T·∫£i ·∫£nh v√† d·ª± ƒëo√°n">
            </form>
            <button class="btn-history" onclick="window.location.href='/history'">üìú Xem l·ªãch s·ª≠ d·ª± ƒëo√°n</button>
        </div>

        <!-- Ph·∫ßn k·∫øt qu·∫£ d·ª± ƒëo√°n -->
        {% if image %}
        <div class="container result">
            <h2>K·∫øt qu·∫£ d·ª± ƒëo√°n</h2>
            <p><strong>B·ªánh:</strong> {{ prediction }}</p>
            <p><strong>ƒê·ªô tin c·∫≠y:</strong> {{ '%.2f'|format(confidence * 100) }}%</p>
            <img src="{{ url_for('static', filename='uploads/' + image) }}" alt="·∫¢nh ƒë√£ t·∫£i l√™n" />
        </div>
        {% endif %}
    </div>

    <!-- Ph·∫ßn m√¥ t·∫£ ri√™ng h√†ng d∆∞·ªõi -->
    {% if suggestion %}
    <div class="container suggestion">
        <h2>{{suggestion.name}}</h2>
        <iframe src="https://www.vinmec.com/vie/benh/ung-thu-hac-to-da-4723" width="30%" height="300"
            style="border:1px solid #ccc;"></iframe>

        <p><strong>M√¥ t·∫£:</strong> {{ suggestion.description }}</p>
        <p><a href="{{ suggestion.article }}" target="_blank">üîó B√†i vi·∫øt li√™n quan</a></p>
        <p><a href="{{ suggestion.advice }}" target="_blank">üí° T∆∞ v·∫•n ƒëi·ªÅu tr·ªã</a></p>
        <img src="{{ url_for('static', filename='suggestions/' + suggestion.image) }}" alt="·∫¢nh b·ªánh" />
    </div>
    {% endif %}

    <!-- N√∫t b·∫≠t/t·∫Øt chat box -->
    <button id="toggle-chat-btn">üí¨</button>

    <!-- Chat box container -->
    <div id="chatbot-container">
        <h2>Chatbot t∆∞ v·∫•n b·ªánh da li·ªÖu</h2>
        <div id="chat-box"></div>
        <div class="chat-input-area">
            <input type="text" id="chat-input" placeholder="Nh·∫≠p c√¢u h·ªèi v·ªÅ b·ªánh da li·ªÖu..." />
            <button id="send-btn">G·ª≠i</button>
        </div>
    </div>
    <script>
        // Ch·ª©c nƒÉng chuy·ªÉn h∆∞·ªõng ƒë·∫øn trang l·ªãch s·ª≠
        document.querySelector('.btn-history').addEventListener('click', function () {
            window.location.href = '/history';
        });

        const chatBox = document.getElementById('chat-box');
        const chatInput = document.getElementById('chat-input');
        const sendBtn = document.getElementById('send-btn');

        sendBtn.addEventListener('click', async () => {
            const question = chatInput.value.trim();
            if (!question) return;

            appendMessage('B·∫°n', question);
            chatInput.value = '';
            appendMessage('Chatbot', 'ƒêang tr·∫£ l·ªùi...');

            try {
                const response = await fetch('/chatbot', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ question })
                });
                const data = await response.json();

                removeLastMessage('Chatbot');

                if (data.answer) {
                    appendMessage('Chatbot', data.answer);
                } else {
                    appendMessage('Chatbot', 'Xin l·ªói, t√¥i ch∆∞a c√≥ c√¢u tr·∫£ l·ªùi cho c√¢u h·ªèi n√†y.');
                }
            } catch (error) {
                removeLastMessage('Chatbot');
                appendMessage('Chatbot', 'C√≥ l·ªói x·∫£y ra, vui l√≤ng th·ª≠ l·∫°i.');
                console.error(error);
            }
        });

        function appendMessage(sender, text) {
            const msg = document.createElement('div');
            msg.style.marginBottom = '10px';
            msg.innerHTML = `<strong>${sender}:</strong> ${text}`;
            chatBox.appendChild(msg);
            chatBox.scrollTop = chatBox.scrollHeight;
        }

        function removeLastMessage(sender) {
            const messages = chatBox.querySelectorAll('div');
            for (let i = messages.length - 1; i >= 0; i--) {
                if (messages[i].innerHTML.startsWith(`<strong>${sender}:</strong>`)) {
                    chatBox.removeChild(messages[i]);
                    break;
                }
            }
        }
        const toggleBtn = document.getElementById('toggle-chat-btn');
        const chatbotContainer = document.getElementById('chatbot-container');

        toggleBtn.addEventListener('click', () => {
            if (chatbotContainer.style.display === 'none' || chatbotContainer.style.display === '') {
                chatbotContainer.style.display = 'flex';
                toggleBtn.textContent = '‚úñ';  // ƒë·ªïi bi·ªÉu t∆∞·ª£ng th√†nh d·∫•u x khi m·ªü
            } else {
                chatbotContainer.style.display = 'none';
                toggleBtn.textContent = 'üí¨';  // ƒë·ªïi l·∫°i bi·ªÉu t∆∞·ª£ng chat khi ·∫©n
            }
        });
    </script>
</body>

</html>